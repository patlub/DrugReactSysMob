<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title></title>
    <link href="css/style.css" type="text/css" rel="stylesheet">
    <link href="jquery/jquery.mobile-1.4.5.min.css" rel="stylesheet"/>
    <script src="jquery/jquery-latest.min.js" type="text/javascript"></script>
    <script src="jquery/jquery-ui.js" type="text/javascript"></script>
    <script src="jquery/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="jquery/jquery.mobile-1.4.5.min.js" type="text/javascript"></script>
    <link href="validate/css/screen.css" rel="stylesheet">
    <script type="text/javascript" src="validate/dist/jquery.validate.min.js"></script>
    <script type="application/javascript" src="js/fastclick.js"></script>
    <script type="text/javascript" src="jQuery-Picture/js/jquery-picture-min.js"></script>
    <script type="text/javascript" src="jQuery-Picture/js/jquery-picture.js"></script>
    <script type="text/javascript" src="jQuery-Picture/demo/assets/js/modernizr.js"></script>
    <script type="text/javascript" src="jquery/jquery.mobile.dynamic.popup.js"></script>
    <script type="text/javascript">
        $(function() {
            FastClick.attach(document.body);
        });

        var EMPTY = "";
        var MISSING = "missing";
        var session_var = null;

        function checkDrugPopup() {
            $.dynamic_popup({
                content: '<form>' +
                '<div><label for="selectDrug">Select Drug</label></div>' +
                '<div style="padding-bottom: 10px;"><select id="selectDrug" name="selectDrug"  style="width: 120px; height: 25px;"><option>Select Drug</option></select></div>' +
                '<div><input type="submit" value="check" id="checkDrugButton" style="width: 60px; height: 30px;" data-inline="true"/></div>' +
                '</form>',
                'data-transition': 'slideup',
                'data-theme': 'b'
            });
            $.getJSON("http://localhost/DrugreactSysWeb/Php/drugsJSON.php", function (data) {
                var select = $('#selectDrug');
                $.each(data, function () {
                    select.append($("<option />").val(this.drugName).text(this.drugName));
                });
            });
        }
        function networkError(){
            $.dynamic_popup({
                content:
                        '<div>Network Error</div>',
                        'data-transition': 'none',
                        'data-theme': 'b'
            });
        }
        function signInPopup() {
            $.dynamic_popup({
                content:
                '<div data-role="content" data-theme="b">'+
                '<div style="padding-bottom: 15px;">Sign In</div>'+
                '<form id="loginForm" action="http://localhost/DrugreactSysWeb/Php/login.php">'+
                '<div id="usernameDiv" data-role="fieldcontain" style="padding-bottom: 20px;">'+
                '<input type="email" id="loginEmail" name="loginEmail" style="height: 25px;" placeholder="Email" oninvalid="this.style.borderColor=#FF0000" required/>'+
                '</div>'+
                '<div id="passwordDiv" data-role="fieldcontain" style="padding-bottom: 10px;">'+
                '<input type="password" id="password" name="password" style="height: 25px;" placeholder="Password" minlength="5" required/>'+
                '</div>'+
                '<div id="submitDiv" data-role="fieldcontain">'+
                '<input type="submit" id="login" name="login" value="Login" style="width: 60px; height: 30px;" data-inline="true"/>'+
                '<p style="float: right; color: #00FF00;" onclick="signUp();">'+
                'Sign up now</p>'+
                '</div>'+
                '</form>'+
                '</div>',
                'data-transition': 'slideup',
                'data-theme': 'b',
                'data-position-to': 'center'
            });

            $("#loginForm").validate({
                rules:{
                    loginEmail:{
                        required: true,
                        email: true
                    },
                    password:{
                        required: true,
                        minlength: 5
                    }
                },
                messages:{
                    password:{
                        minlength: "Minimum length must be 5"
                    }
                }
            });
            $('#loginForm').submit(function(e) {
                var $this = $(this);
                e.preventDefault();
                var interval = setInterval(function(){
                    $.mobile.loading('show');
                    clearInterval(interval);
                });
                $.post($this.attr('action'), $this.serialize())
                        .done(
                        function(data) {
                            var interval = setInterval(function(){
                            $.mobile.loading('hide');
                            clearInterval(interval);
                            });

                            if(data) {
                                $('.signIn').hide();
                                $('.signUp').hide();
                                var currentPage = $.mobile.activePage.attr('id');
                                $.mobile.changePage('#'+currentPage);
                            }
                            else{
                                $('.error').fadeIn(400).delay(3000).fadeOut(400); //fade out after 3 seconds
                            }
                        })
                        .fail( function(XMLHttpRequest, textStatus, errorThrown) {
                            var interval = setInterval(function(){
                                $.mobile.loading('hide');
                                clearInterval(interval);
                            });
                            $('.networkError').fadeIn(400).delay(3000).fadeOut(400); //fade out after 3 seconds
                        });
                return false;
            });
        }
        function signUp(){
            $.mobile.changePage('#registerPage', {transition: 'flow'});
        }
        function signOut(){
            $.ajax({
                dataType: "text",
                url: "http://localhost/DrugreactSysWeb/Php/logout.php",
                beforeSend: function () {
                    var interval = setInterval(function(){
                        $.mobile.loading('show');
                        clearInterval(interval);
                    });
                },
                success: function(data){
                    if(data){
                        $('.signIn').show();
                        $('.signOut').hide();
                        session_var = false;
                        $.mobile.changePage('#homePage');
                    }
//                        else
//                            $('.error').fadeIn(400).delay(3000).fadeOut(400); //fade out after 3 seconds
                },
                complete: function(){
                    var interval = setInterval(function(){
                        $.mobile.loading('hide');
                        clearInterval(interval);
                    });
                },
                error: function () {
                    var interval = setInterval(function(){
                        $.mobile.loading('hide');
                        clearInterval(interval);
                    });
//                    $('.networkError').fadeIn(400).delay(3000).fadeOut(400); //fade out after 3 seconds
                }
            });
        }
    </script>

</head>
<body>

<div data-role="page" id="homePage" data-theme="b">
    <div data-role="panel" data-position="left" data-display="reveal" id="homePanel" data-swipe-close="true">

        <div style="color: firebrick; font-weight: bolder;">Drug Reaction<span class="icon"></span></div>
        <div class="panel" onclick="$.mobile.changePage('#homePage', { transition: 'slide'} );">Home</div>
        <div class="panel" onclick="checkDrugPopup();">Check Drug</div>
        <div class="panel" onclick="$.mobile.changePage('#drugRequests', { transition: 'slide'} );">Drug Requests</div>
        <div class="panel" onclick="$.mobile.changePage('#drugReports', { transition: 'slide'} );">Drug Reports</div>
        <div class="panel signIn" onclick="signInPopup();">Sign In</div>
        <div class="panel" onclick="signUp();">Sign Up</div>
        <div class="panel signOut" onclick="signOut();">Sign Out</div>

    </div>
    <div data-role="header" style="background-color: green; color: #FFFFFF;text-align: left;">
        <a href="#homePanel" data-role="button" data-icon="grid" data-iconpos="notext">Drug Reaction</a>
            <h3 style="text-align: left;">Home</h3>
    </div>

    <div data-role="content">

        <div align="center"><picture>
            <source src="sizedImages/maxresdefaultsmall.jpg">
            <source src="sizedImages/maxresdefaultmedium.jpg" media="(min-width:240px)">
            <source src="sizedImages/maxresdefault.jpg" media="(min-width:600px)">
            <noscript>
                <img src="sizedImages/maxresdefault.jpg">
            </noscript>
        </picture></div>
        <script type="text/javascript">
            $(function(){
                $('picture').picture();
            });
        </script>
        <div>

           <div id="featuredDrug" style="padding-top: 10px; padding-bottom: 5px; text-align: center; font-weight: bold;">Featured Drug</div>
            <div id="featuredDrugJSONDiv"></div>
            <div class="error" style="display:none">Invalid Login</div>
            <div class="networkError" style="display:none">Network Error</div>
            <script type="text/javascript">
                $( document ).delegate("#homePage", "pageinit", function() {
                        $.ajax({
                        dataType: "json",
                        url: "http://localhost/DrugreactSysWeb/Php/featuredDrug.php",
                        beforeSend: function () {
                            var interval = setInterval(function(){
                                $.mobile.loading('show');
                                clearInterval(interval);
                            });
                        },
                        success: function(data){
                            $.each(data, function () {
                                $('#featuredDrugJSONDiv').append($('<div style="padding-bottom: 10px">')
                                        .append($('<div id="featuredDrugName">').append(this.drugName))
                                        .append($('<div id="featuredDrugSickness">').append('Treatment For: ' + this.sickness))
                                        .append($('<div id="featuredDrugDosage">').append('Dosage: ' + this.dosage))
                                        .append($('<div id="featuredDrugEffects">').append('Known Side Effects: '+ this.sideSigns + ', ' + this.sideSymptoms)));
                            });
                        },
                        complete: function(){
                            var interval = setInterval(function(){
                                $.mobile.loading('hide');
                                clearInterval(interval);
                            });
                        },
                        error: function () {
                            $('.networkError').fadeIn(400).delay(3000).fadeOut(400); //fade out after 3 seconds
                        }
                    });
                });
            </script>

        </div>
    </div>
</div>

<div data-role="page" id="registerPage" data-theme="b">
    <div data-role="panel" data-position="left" data-display="reveal" id="registerPanel">

        <div style="color: firebrick; font-weight: bolder;">Drug Reaction<span class="icon"></span></div>
        <div class="panel" data-transition="slide" onclick="location.href='#homePage'">Home</div>
        <div class="panel" onclick="checkDrugPopup();">Check Drug</div>
        <div class="panel" data-transition="slide" onclick="location.href='#drugRequests'">Drug Requests</div>
        <div class="panel" data-transition="slide" onclick="location.href='#drugReports'">Drug Reports</div>
        <div class="panel" onclick="signInPopup();">Sign In</div>
        <div class="panel">Sign Out</div>

    </div>
    <div data-role="header" id="hdrReg">
        <a href="#registerPanel" class="showMenu" data-role="button" data-icon="grid" data-iconpos="notext">Drug Reaction</a>
        <h1>Drug Reaction</h1>
    </div>
        <div data-role="content">
            <div class="error" style="display:none">Invalid Login</div>
            <div class="networkError" style="display:none">Network Error</div>
        <form id="registrationForm" action="http://localhost/DrugreactSysWeb/Php/register.php">
            <div id="firstnameDiv" data-role="fieldcontain">
                <input type="text" id="firstName" name="firstname" placeholder="First Name" required />
            </div>
            <div id="lastnameDiv" data-role="fieldcontain">
                <input type="text" id="lastName" name="lastname" placeholder="Last Name" oninvalid="this.style.borderColor='#FF0000';" required />
            </div>
            <div id="emailDiv" data-role="fieldcontain">
                <input type="email" id="email" name="email" placeholder="Email Address" oninvalid="this.style.borderColor='#FF0000';" required />
            </div>
            <div id="passwordregDiv" data-role="fieldcontain">
                <input type="password" id="passwordReg" name="passwordreg" placeholder="Password" minlength="5" oninvalid="this.style.borderColor='#FF0000';" required />
            </div>
            <div id="confirmDiv" data-role="fieldcontain">
                <input type="password" id="confirm" name="confirm" placeholder="Confirm Password" minlength="5" oninvalid="this.style.borderColor='#FF0000';" required/>
            </div>
            <div id="registerDiv" data-role="fieldcontain">
                <input type="submit" id="register" name="register" value="Register" data-inline="true"/>
            </div>
        </form>
    </div>

    <div data-role="footer">

    </div>

    <script type="text/javascript">
//        $().ready(function(){
//            $("#registrationForm").validate({
//                rules:{
//                    firstname: "required",
//                    lastname : "required",
//                    email:{
//                        required: true,
//                        email: true
//                    },
//                    passwordreg:{
//                        required: true,
//                        minlength: 5
//                    },
//                    confirm:{
//                        required: true,
//                        minlength: 5,
//                        equalTo: "#passwordReg"
//                    }
//                },
//                messages:{
//                    passwordreg:{
//                        minlength: "Minimum length must be 5"
//                    },
//                    confirm:{
//                        minlength: "Minimum length must be 5",
//                         equalTo: "Passwords don't match"
//                    }
//                }
//            });
//        });
    $('#registrationForm').submit(function(e) {
        var $this = $(this);
        e.preventDefault();
        var interval = setInterval(function(){
            $.mobile.loading('show');
            clearInterval(interval);
        });
        $.post($this.attr('action'), $this.serialize())
                .done(
                function(data) {
                    var interval = setInterval(function(){
                        $.mobile.loading('hide');
                        clearInterval(interval);
                    });
                    if(data) {
                        $('.signIn').hide();
                        $('.signUp').hide();
                        $.mobile.changePage('#homePage');
                    }
                })
                .fail( function(XMLHttpRequest, textStatus, errorThrown) {
                    var interval = setInterval(function(){
                        $.mobile.loading('hide');
                        clearInterval(interval);
                    });
                    $('.networkError').fadeIn(400).delay(3000).fadeOut(400); //fade out after 3 seconds
                });
        return false;
    });
    </script>
</div>

<div data-role="page" id="drugRequests" data-theme="b">
    <div data-role="panel" data-position="left" data-display="reveal" id="requestPanel" data-swipe-close="true">

        <div style="color: firebrick; font-weight: bolder;">Drug Reaction<span class="icon"></span></div>
        <div class="panel" onclick="$.mobile.changePage('#homePage', { transition: 'slide'} );">Home</div>
        <div class="panel" onclick="checkDrugPopup();">Check Drug</div>
        <div class="panel" onclick="$.mobile.changePage('#drugRequests', { transition: 'slide'} );">Drug Requests</div>
        <div class="panel" onclick="$.mobile.changePage('#drugReports', { transition: 'slide'} );">Drug Reports</div>
        <div class="panel" onclick="signInPopup();">Sign In</div>
        <div class="panel">Sign Out</div>

    </div>
    <div data-role="header" style="background-color: orange; color: #FFFFFF;">
        <h3>Drug Requests</h3>
        <a href="#requestPanel" class="showMenu" data-role="button" data-icon="grid" data-iconpos="notext">Drug Reaction</a>
    </div>

    <div data-role="content">
        <div class="error" style="display:none">Invalid Login</div>
        <div class="networkError" style="display:none">Network Error</div>
        <div onclick="if(session_var != null){ $('#requestDrugPopup').popup('open');}else{signInPopup();}"><a href="" data-role="button" data-inline="true">Request Drug</a>

        </div>
        <div id="drugRequestInformer"></div>
        <div id="requestJSONDiv"></div>
        <script type="text/javascript">
//            if(session_var == true) {
                $(document).delegate("#drugRequests", "pageinit", function () {
                    $.ajax({
                        dataType: "json",
                        url: "http://localhost/DrugreactSysWeb/Php/drugRequestsJSON.php",
                        beforeSend: function () {
                            var interval = setInterval(function () {
                                $.mobile.loading('show');
                                clearInterval(interval);
                            });
                        },
                        success: function (data) {
                            $.each(data, function () {
                                $('#requestJSONDiv').append($('<div style="padding-bottom: 10px">')
                                        .append($('<div>').append(this.reqSickness))
                                        .append($('<div>').append(this.reqSigns))
                                        .append($('<div>').append(this.reqSymptoms))
                                        .append($('<div>').append(this.sicknessPeriod))
                                        .append($('<div>').append(this.date))
                                        .append($('<div>').append(this.answer)));
                            });
                        },
                        complete: function () {
                            var interval = setInterval(function () {
                                $.mobile.loading('hide');
                                clearInterval(interval);
                            });
                        },
                        error: function () {

                        }
                    });
                });
//            }
//            else{
//                drugRequestInformer.innerHTML = "Sign in to request a drug and view a history of your drug requests";
//            }
        </script>
    </div>
    <div data-role="footer">

    </div>
    <div data-role="popup" id="requestDrugPopup" class="" data-position-to="window" data-theme="b">
        <form id="requestDrugForm" action="http://localhost/DrugreactSysWeb/Php/request.php">
            <div data-role="header">
                <h2>Drug Requests</h2>
            </div>
            <div data-role="content">
                <input type="text" id="enterSickness" name="enterSickness" placeholder="Enter Sickness" required/>
                <textarea id="requestEnterSigns" name="requestEnterSigns" placeholder="Signs(None if not any)"></textarea>
                <textarea id="requestEnterSymptoms" name="requestEnterSymptoms" placeholder="Symptoms(None if not any)"></textarea>
                <input type="text" id="sicknessPeriod" name="sicknessPeriod" placeholder="Period Of Sickness" required/>
                <input type="submit" value="Send Request" id="requestDrugButton" data-inline="true"/>
            </div>
        </form>
        <script type="text/javascript">


        </script>
    </div>
    <script type="text/javascript">
//        $().ready(function(){
//            $("#requestDrugForm").validate({
//                rules:{
//                    enterSickness: "required",
//                    sicknessPeriod : "required"
//                }
//            });
//        });
        $('#requestDrugForm').submit(function(event){
            var $this = $(this);
            event.preventDefault();

            $.post($this.attr('action'),$this.serialize(),function(data){
                document.write(data);
            });
            return false;
        });
    </script>
</div>

<div data-role="page" id="drugReports" data-theme="b">
    <div data-role="panel" data-position="left" data-display="reveal" id="reportPanel" data-swipe-close="true">

        <div style="color: firebrick; font-weight: bolder;">Drug Reaction<span class="icon"></span></div>
        <div class="panel" onclick="$.mobile.changePage('#homePage', { transition: 'slide'} );">Home</div>
        <div class="panel" onclick="checkDrugPopup();">Check Drug</div>
        <div class="panel" onclick="$.mobile.changePage('#drugRequests', { transition: 'slide'} );">Drug Requests</div>
        <div class="panel" onclick="$.mobile.changePage('#drugReports', { transition: 'slide'} );">Drug Reports</div>
        <div class="panel" onclick="signInPopup();">Sign In</div>
        <div class="panel">Sign Out</div>

    </div>
    <div data-role="header" style="background-color: blueviolet; color: #FFFFFF;">
        <a href="#reportPanel" class="showMenu" data-role="button" data-icon="grid" data-iconpos="notext">Drug Reaction</a>
        <h3>Drug Reports</h3>
    </div>

    <div data-role="content">
        <div class="error" style="display:none">Invalid Login</div>
        <div class="networkError" style="display:none">Network Error</div>
        <div onclick="if(session_var != null){$.mobile.changePage('#reportDrugPage', { transition: 'slide'} );}else{signInPopup();}"><a href="" data-role="button" data-inline="true">Report Drug</a>
        <div id="drugReportInformer"></div>
        <div id="reportJSONDiv"></div>
        <script type="text/javascript">
            if(session_var != null) {
                $(document).delegate("#drugReports", "pageinit", function () {
                    $.ajax({
                        dataType: "json",
                        url: "http://localhost/DrugreactSysWeb/Php/drugReportsJSON.php",
                        beforeSend: function () {
                            var interval = setInterval(function () {
                                $.mobile.loading('show');
                                clearInterval(interval);
                            });
                        },
                        success: function (data) {
                            $.each(data, function () {
                                $('#reportJSONDiv').append($('<div style="padding-bottom: 10px">')
                                        .append($('<div>').append(this.repDrugName))
                                        .append($('<div>').append(this.repSickness))
                                        .append($('<div>').append(this.repDosage))
                                        .append($('<div>').append(this.repSideSigns))
                                        .append($('<div>').append(this.repSideSymptoms))
                                        .append($('<div>').append(this.repMedPeriod))
                                        .append($('<div>').append(this.date))
                                        .append($('<div>').append(this.answer)));
                            });
                        },
                        complete: function () {
                            var interval = setInterval(function () {
                                $.mobile.loading('hide');
                                clearInterval(interval);
                            });

                        },
                        error: function () {

                        }
                    });
                });
            }
            else{
                drugReportInformer.innerHTML = "Sign in to report a drug and view a history of your drug reports";
            }
        </script>

    </div>
    <div data-role="footer">

    </div>
</div>

<div data-role="page" id="reportDrugPage" data-theme="b">
    <div data-role="panel" data-position="left" data-display="reveal" id="reportDrugPanel">

        <div style="color: firebrick; font-weight: bolder;">Drug Reaction<span class="icon"></span></div>
        <div class="panel" data-transition="slide" onclick="location.href='#homePage'">Home</div>
        <div class="panel" onclick="checkDrugPopup();">Check Drug</div>
        <div class="panel" data-transition="slide" onclick="location.href='#drugRequests'">Drug Requests</div>
        <div class="panel" data-transition="slide" onclick="location.href='#drugReports'">Drug Reports</div>
        <div class="panel" onclick="signInPopup();">Sign In</div>
        <div class="panel">Sign Out</div>

    </div>
        <div data-role="header">
            <a href="#reportDrugPanel" class="showMenu" data-role="button" data-icon="grid" data-iconpos="notext">Drug Reaction</a>
            <h2>Report Drug</h2>
        </div>
        <div data-role="content">
            <div class="error" style="display:none">Invalid Login</div>
            <div class="networkError" style="display:none">Network Error</div>
            <form id="reportDrugForm" action="http://localhost/DrugreactSysWeb/Php/report.php">
            <input type="text" id="enterDrugName" name="enterDrugName" placeholder="Enter Drug Name" required/>
            <input type="text" id="reportSickness" name="reportEnterSickness" placeholder="Enter Sickness" required/>
            <input type="text" id="dosage" name="dosage" placeholder="Enter Dosage(Days)" required/>
            <textarea id="reportSigns" name="reportSigns" placeholder="(Side Effects)Signs, Enter none if noy any"></textarea>
            <textarea id="reportSymptoms" name="reportSymptoms" placeholder="(Side Effects)Symptoms, Enter none if noy any"></textarea>
            <input type="text" id="reportMedicationPeriod" name="reportMedicationPeriod" placeholder="Period Of Medication(days)" required/>
            <input type="submit" value="Send Report" id="reportDrugButton" data-inline="true"/>
            </form>

        </div>

    <script type="text/javascript">
//        $().ready(function(){
//            $("#reportDrugForm").validate({
//                rules:{
//                    enterDrugName: "required",
//                    reportEnterSickness : "required",
//                    dosage : "required",
//                    reportMedicationPeriod: "required"
//                }
//            });
//        });
        $('#reportDrugForm').submit(function(event){
            var $this =$(this);
            event.preventDefault();
            $.post($this.attr('action'),$this.serialize(),function(data){
                document.write(data);
            });
            return false;
        });
    </script>
</div>
<script type="text/javascript">
    $('body').on('swiperight', function () {
        $('#homePanel,#reportDrugPanel,#registerPanel,#requestPanel,#reportPanel').panel('open', '');
    });

    $('body').on('swipeleft', function () {
        $('#homePanel,#reportDrugPanel,#registerPanel,#requestPanel,#reportPanel').panel('close', '');
    });
    $('.signOut').hide();
</script>
</body>
</html>